- [网络管理概论](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e6%a6%82%e8%ae%ba)
  - [网络管理实体](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e5%ae%9e%e4%bd%93)
  - [网络管理实体任务](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e5%ae%9e%e4%bd%93%e4%bb%bb%e5%8a%a1)
  - [委托代理（Proxy）](#%e5%a7%94%e6%89%98%e4%bb%a3%e7%90%86proxy)
  - [而代理与监视器进行信息传输的机制](#%e8%80%8c%e4%bb%a3%e7%90%86%e4%b8%8e%e7%9b%91%e8%a7%86%e5%99%a8%e8%bf%9b%e8%a1%8c%e4%bf%a1%e6%81%af%e4%bc%a0%e8%be%93%e7%9a%84%e6%9c%ba%e5%88%b6)
  - [网络管理五大功能域(F-CAPS)](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e4%ba%94%e5%a4%a7%e5%8a%9f%e8%83%bd%e5%9f%9ff-caps)
  - [网络管理的两类性能指标](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e7%9a%84%e4%b8%a4%e7%b1%bb%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87)
  - [面向服务的性能指标](#%e9%9d%a2%e5%90%91%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87)
  - [面向效率的性能指标](#%e9%9d%a2%e5%90%91%e6%95%88%e7%8e%87%e7%9a%84%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87)
  - [网络管理协议标准规范的一些缩写](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e5%8d%8f%e8%ae%ae%e6%a0%87%e5%87%86%e8%a7%84%e8%8c%83%e7%9a%84%e4%b8%80%e4%ba%9b%e7%bc%a9%e5%86%99)
- [抽象与法表示 ASN.1](#%e6%8a%bd%e8%b1%a1%e4%b8%8e%e6%b3%95%e8%a1%a8%e7%a4%ba-asn1)
  - [标签 tag](#%e6%a0%87%e7%ad%be-tag)
  - [隐式的标签、显式的标签](#%e9%9a%90%e5%bc%8f%e7%9a%84%e6%a0%87%e7%ad%be%e6%98%be%e5%bc%8f%e7%9a%84%e6%a0%87%e7%ad%be)
  - [子类型](#%e5%ad%90%e7%b1%bb%e5%9e%8b)
  - [基本编码规则(Basic Encoding Rule)](#%e5%9f%ba%e6%9c%ac%e7%bc%96%e7%a0%81%e8%a7%84%e5%88%99basic-encoding-rule)
- [管理信息库](#%e7%ae%a1%e7%90%86%e4%bf%a1%e6%81%af%e5%ba%93)
  - [MIB 树](#mib-%e6%a0%91)
  - [SNMP 环境中的所有管理对象组织成分层的树结构](#snmp-%e7%8e%af%e5%a2%83%e4%b8%ad%e7%9a%84%e6%89%80%e6%9c%89%e7%ae%a1%e7%90%86%e5%af%b9%e8%b1%a1%e7%bb%84%e7%bb%87%e6%88%90%e5%88%86%e5%b1%82%e7%9a%84%e6%a0%91%e7%bb%93%e6%9e%84)
  - [MIB 中的数据类型](#mib-%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b)
  - [SNMPv1 中索引对象实例值转换成子标识符的转换规则](#snmpv1-%e4%b8%ad%e7%b4%a2%e5%bc%95%e5%af%b9%e8%b1%a1%e5%ae%9e%e4%be%8b%e5%80%bc%e8%bd%ac%e6%8d%a2%e6%88%90%e5%ad%90%e6%a0%87%e8%af%86%e7%ac%a6%e7%9a%84%e8%bd%ac%e6%8d%a2%e8%a7%84%e5%88%99)
- [简单网络管理协议](#%e7%ae%80%e5%8d%95%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e5%8d%8f%e8%ae%ae)
  - [SNMPv1](#snmpv1)
    - [SNMPv1 报文](#snmpv1-%e6%8a%a5%e6%96%87)
    - [SNMPv1 的操作](#snmpv1-%e7%9a%84%e6%93%8d%e4%bd%9c)
    - [SNMPv1 局限性](#snmpv1-%e5%b1%80%e9%99%90%e6%80%a7)
  - [SNMPv2](#snmpv2)
    - [SNMPv2 的两类表](#snmpv2-%e7%9a%84%e4%b8%a4%e7%b1%bb%e8%a1%a8)
    - [允许生成和删除行的表的列对象](#%e5%85%81%e8%ae%b8%e7%94%9f%e6%88%90%e5%92%8c%e5%88%a0%e9%99%a4%e8%a1%8c%e7%9a%84%e8%a1%a8%e7%9a%84%e5%88%97%e5%af%b9%e8%b1%a1)
    - [SNMPv2 表的定义中的 INDEX 和 AUGMENTS 子句](#snmpv2-%e8%a1%a8%e7%9a%84%e5%ae%9a%e4%b9%89%e4%b8%ad%e7%9a%84-index-%e5%92%8c-augments-%e5%ad%90%e5%8f%a5)
      - [INDEX 子句](#index-%e5%ad%90%e5%8f%a5)
      - [AUGMENTS 子句](#augments-%e5%ad%90%e5%8f%a5)
    - [SNMPv2 的 3 种访问管理信息的方法](#snmpv2-%e7%9a%84-3-%e7%a7%8d%e8%ae%bf%e9%97%ae%e7%ae%a1%e7%90%86%e4%bf%a1%e6%81%af%e7%9a%84%e6%96%b9%e6%b3%95)
    - [SNMPv2 共有 7 种协议数据单元，分为 3 种 PDU 格式](#snmpv2-%e5%85%b1%e6%9c%89-7-%e7%a7%8d%e5%8d%8f%e8%ae%ae%e6%95%b0%e6%8d%ae%e5%8d%95%e5%85%83%e5%88%86%e4%b8%ba-3-%e7%a7%8d-pdu-%e6%a0%bc%e5%bc%8f)
    - [SNMPv2 对 GetRequest 操作的响应方式](#snmpv2-%e5%af%b9-getrequest-%e6%93%8d%e4%bd%9c%e7%9a%84%e5%93%8d%e5%ba%94%e6%96%b9%e5%bc%8f)
    - [SNMPv2 对 GetNextRequest 操作的响应方式](#snmpv2-%e5%af%b9-getnextrequest-%e6%93%8d%e4%bd%9c%e7%9a%84%e5%93%8d%e5%ba%94%e6%96%b9%e5%bc%8f)
    - [SNMPv2 对 GetBulkRequest 操作的响应方式](#snmpv2-%e5%af%b9-getbulkrequest-%e6%93%8d%e4%bd%9c%e7%9a%84%e5%93%8d%e5%ba%94%e6%96%b9%e5%bc%8f)
    - [InformRequest](#informrequest)
  - [SNMPv3](#snmpv3)
    - [SNMP 引擎结构](#snmp-%e5%bc%95%e6%93%8e%e7%bb%93%e6%9e%84)
    - [SNMP 引擎服务](#snmp-%e5%bc%95%e6%93%8e%e6%9c%8d%e5%8a%a1)
    - [SNMPv3 的报文处理子系统](#snmpv3-%e7%9a%84%e6%8a%a5%e6%96%87%e5%a4%84%e7%90%86%e5%ad%90%e7%b3%bb%e7%bb%9f)
    - [SNMPv3 的安全子系统](#snmpv3-%e7%9a%84%e5%ae%89%e5%85%a8%e5%ad%90%e7%b3%bb%e7%bb%9f)
      - [SNMPv3 安全协议的 3 个模块](#snmpv3-%e5%ae%89%e5%85%a8%e5%8d%8f%e8%ae%ae%e7%9a%84-3-%e4%b8%aa%e6%a8%a1%e5%9d%97)
        - [时间序列模块：提供对报文延迟和重放的防护](#%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%a8%a1%e5%9d%97%e6%8f%90%e4%be%9b%e5%af%b9%e6%8a%a5%e6%96%87%e5%bb%b6%e8%bf%9f%e5%92%8c%e9%87%8d%e6%94%be%e7%9a%84%e9%98%b2%e6%8a%a4)
        - [认证模块：提供完整性和数据源认证](#%e8%ae%a4%e8%af%81%e6%a8%a1%e5%9d%97%e6%8f%90%e4%be%9b%e5%ae%8c%e6%95%b4%e6%80%a7%e5%92%8c%e6%95%b0%e6%8d%ae%e6%ba%90%e8%ae%a4%e8%af%81)
        - [加密模块：防止报文内容的泄露](#%e5%8a%a0%e5%af%86%e6%a8%a1%e5%9d%97%e9%98%b2%e6%ad%a2%e6%8a%a5%e6%96%87%e5%86%85%e5%ae%b9%e7%9a%84%e6%b3%84%e9%9c%b2)
    - [访问控制子系统通过访问控制模块](#%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e5%ad%90%e7%b3%bb%e7%bb%9f%e9%80%9a%e8%bf%87%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e6%a8%a1%e5%9d%97)
    - [SNMPv3 的应用程序](#snmpv3-%e7%9a%84%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f)
- [远程网络监视](#%e8%bf%9c%e7%a8%8b%e7%bd%91%e7%bb%9c%e7%9b%91%e8%a7%86)
  - [位过滤逻辑](#%e4%bd%8d%e8%bf%87%e6%bb%a4%e9%80%bb%e8%be%91)
  - [RMON](#rmon)
  - [RMON2](#rmon2)
- [SNMPc 网络管理软件的使用](#snmpc-%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e8%bd%af%e4%bb%b6%e7%9a%84%e4%bd%bf%e7%94%a8)
- [网络分析系统](#%e7%bd%91%e7%bb%9c%e5%88%86%e6%9e%90%e7%b3%bb%e7%bb%9f)
- [网络管理工具](#%e7%bd%91%e7%bb%9c%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7)
- [网络测试与性能评价](#%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e4%b8%8e%e6%80%a7%e8%83%bd%e8%af%84%e4%bb%b7)
  - [网络系统测试](#%e7%bd%91%e7%bb%9c%e7%b3%bb%e7%bb%9f%e6%b5%8b%e8%af%95)
  - [网络测试工具](#%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e5%b7%a5%e5%85%b7)
  - [网络测试过程](#%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e8%bf%87%e7%a8%8b)
  - [网络测量方法](#%e7%bd%91%e7%bb%9c%e6%b5%8b%e9%87%8f%e6%96%b9%e6%b3%95)
  - [二/三层设备转发性能测试中，交换机按照处理帧的不同方式](#%e4%ba%8c%e4%b8%89%e5%b1%82%e8%ae%be%e5%a4%87%e8%bd%ac%e5%8f%91%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e4%b8%ad%e4%ba%a4%e6%8d%a2%e6%9c%ba%e6%8c%89%e7%85%a7%e5%a4%84%e7%90%86%e5%b8%a7%e7%9a%84%e4%b8%8d%e5%90%8c%e6%96%b9%e5%bc%8f)
  - [三种转发时延类型](#%e4%b8%89%e7%a7%8d%e8%bd%ac%e5%8f%91%e6%97%b6%e5%bb%b6%e7%b1%bb%e5%9e%8b)

# 网络管理概论

## 网络管理实体

关于网络管理系统的配置，每一个网络节点都包含一组与管理有关的软件，叫做网络管理实体(Network Management Entity, NME)

## 网络管理实体任务

    1. 收集有关网络通信的统计信息、对本地设备进行测试，记录设备状态信息
    2. 在本地存储有关信息
    3. 响应网络控制中心的请求，发送管理信息
    4. 根据网络控制中心的指令，设置或改变设备参数

在分布式网络管理配置中，分布式管理系统代替了单独的网络控制主机。地理上分布的网络管理客户机与一组网络管理服务器交互作用，共同完成网络管理功能。

## 委托代理（Proxy）

网络管理系统中，管理站和代理需要支持相同的管理协议，但这种要求有时是无法实现的，如有的老设备可能不支持当前的网络管理标准、小的系统可能无法完整实现 NME 的全部功能，甚至还有一些设备根本不能附加的软件，一般把这些设备叫做非标准设备。在这种情况下，可以用一个叫做委托代理的设备（Proxy）来管理一个或多个非标准设备。委托代理和非标准设备之间运行制造商专用的协议，而委托代理和管理站之间运行标准的网络管理协议。这样，管理站就可以用标准的方式通过委托代理得到非标准设备的管理信息，委托代理起到了协议转换的作用

## 而代理与监视器进行信息传输的机制

1. 轮询(Polling)-轮询是一种请求-响应式的交互作用，即由监视器向代理发出请求，询问它所需要的信息数值，代理相应监视器的请求，从它所保存的管理信息库中取得请
   求的信息，返回给监视器。
2. 事件报告(Event Reporting)
 -事件报告是由代理主动发送给管理站的消息。代理可以根据管理站的要求（周期、内容等）定时地发送状态报告，也可能在检测到某些特定事件（例如状态改变）或非正常事件（例如出现故障）时生成事件报告，发送给管理站。

## 网络管理五大功能域(F-CAPS)

1. 故障管理(Fault Management)-网络监视功能
2. 配置管理(Configuration Management)-网络监视功能
3. 计费管理(Accounting Management)-网络监视功能
4. 性能管理(Performance Management)-网络控制功能
5. 安全管理(Security Management)-网络控制功能

## 网络管理的两类性能指标

## 面向服务的性能指标

1. 可用性-网络系统、网络元素或网络应用对用户可利用的时间的百分比
   1. 公式`A=MTBF/(MTBF+MTTR)`，其中 MTBF 为平均无故障时间，MTTR 为平均故障恢复时间
   2. 串联为 A^2，并联为 2A-A^2
2. 响应时间-从用户输入请求到系统在终端上返回计算结果的时间间隔，网络的响应时间由系统各个部分的处理延迟时间组成。利用率是指网络资源利用的百分率。
3. 正确性

## 面向效率的性能指标

1. 吞吐率
2. 利用率

## 网络管理协议标准规范的一些缩写

1. CMIS (Common Management Information Service)
 公共管理信息服务
2. CMIP(Common Management Information Protocol)公共管理信息协议规范；SGMP(Simple Gateway Monitoring Protocol)简单网关监控协议
3. SNMP (Simple Network Management Protocol)
 简单网络管理协议
4. RMON(Remote Monitoring)远程网络监控
5. MIB(Management Information Base)管理信息库

# 抽象与法表示 ASN.1

ASN.1(Abstract Syntax Notation.1)是一种形式语言，它提供统一的网络数据表示，通常用于定义应用数据的抽象语法和应用层协议数据单元的结构。在网络管理中，无论是 OSI 的管理信息结构，或是 SNMP 管理信息库都是用 ASN.1 定义的。用 ASN.1 定义的应用数据在传送过程中要按照一定的规则变换成比特串，这种规则就是基本编码规则（Basic Encoding Rule， BER）。

## 标签 tag

在 ASN.1 中每一个数据类型都有一个标签 tag，标签有类型和值集合两种属性。数据类型是由标签的类型和值唯一决定的。标签类型可分为四种：通用标签，用关键字 UNIVERSAL 表示，带有这种标签的数据类型是由标准定义的，适用于任何应用；应用标签，用关键字 APPLICATION 表示，是由某个具体应用定义的类型；上下文专用标签，这种标签在文本的一定范围（例如一个结构）中适用；私有标签（用关键字 PRIVATE 表示），这是用户定义的标签。
ASN.1 预定义的数据类型有 20 多种，标签类型都是 UNIVERSAL,这些数据类型可以分为四大类：简单类型、构造类型、标签类型和其它类型，包括 CHOICE 和 ANY 两种类型。构造类型有序列和集合两种，分别用 SEQUENCE 和 SEQUENCE OF 表示不同类型和相同类型元素的序列，分别用 SET 和 SET OF 表示不同类型和相同类型元素的集合。序列和集合的区别是前者的元素是有序的，而后者是无序的。除了 sequence 和 set 都是简单类型，这两是构造类型。

## 隐式的标签、显式的标签

标签类型可以使隐式的或显式的，分别用关键字 IMPLICIT 和 EXPLICIT(可省略)表示。

1. 隐式标签的语义是用新标签替换老标签，所以编码时只编码新标签。
2. 显式标签的语义是在一个基类型上加上新标签，从而导出一个新类型。
   事实上，显式标签类型是把基类型作为唯一元素的构造类型，在编码时，新老标签都要编码。可见隐式标签可以产生较短的编码，但显示标签也是有用的，特别用在基类型尚未确定时，例如基类型为 CHOICE 或 ANY 类型。

## 子类型

子类型是由限制父类型的值集合而导出的类型，所以子类型的值集合是父类型的子集
子类型还可以再产生子类型。产生子类型的方法有 6 种：

1. 单个值
2. 包含子类型
3. 值区间
4. 可用字符
5. 限制大小
6. 内部子类型

## 基本编码规则(Basic Encoding Rule)

基本编码规则(Basic Encoding Rule)把 ASN.1 表示的抽象类型值编码为字节串，这种字节串的结构为类型-长度-值，简称 TLV(Type-Length-Value)，而且值部分还可以递归地再编码为 TLV 结构，这样就具有了表达复杂结构的能力。

> ppt 例 2.6
> ![ppt 例2.6](/img/1.tiff)
> 教材 P30\~P33, (2.3 基本编码规则)

# 管理信息库

在 Internet 中，对网络、设备和主机的管理叫做网络管理，网络管理信息存储在管理信息库 MIB 中。图 3.5 描述 SNMP 的配置框架。SNMP 由两部分组成：一部分是管理信息库结构的定义，另一部分是访问管理信息库的协议规范。
![3.5](/img/1.png)

## MIB 树

管理信息库组织成树结构，称为 MIB 树。各个代理中的管理数据由树叶上的对象组成，树的中间结点的作用是对管理对象进行分类。例如，与某一协议实体有关的全部信息位于指定的子树上。树结构为每个叶结点指定惟一的路径标识符，这个标识符是从树根开始把各个数字串联起来形成的。
访问管理信息库的协议规范指的是 SNMP 协议支持的服务原语，这些原语用于管理站和代理之间的通信，以便查询和改变管理信息库中的内容。Get 检索数据，Set 改变数据，而 GetNext 提供扫描 MIB 树和连续检索数据的方法，Trap 则提供从代理进程到管理站的异步报告机制。

## SNMP 环境中的所有管理对象组织成分层的树结构

SNMP 环境中的所有管理对象组织成分层的树结构，这种层次树结构有以下 3 种作用。

1. 表示管理和控制关系
2. 提供了结构化的信息组织技术, 下层的中间结点代表的子树是与每个网络资源或网络协议相关的信息集合
3. 提供了对象命名机制, 树中每个结点都有一个分层的编号。叶子结点代表实际的管理对象
   从树根到树叶的编号串联起来，用圆点隔开，就形成了管理对象的全局标识。例如 internet 的标识符是 1.3.6.1,或者写为\{iso(1)
 org(3)
 dod(6)
 1\} 。

## MIB 中的数据类型

MIB 中存储的数据叫对象，每个对象属于一定的对象类型，并且有一个具体的值。对象类型的定义是一种语法描述，对象实例是对象类型的具体实现，只有实例才可以绑定到特定的值。
SNMP 的对象是用 ASN.1 定义的，这种定义说明管理对象的类型、其组成和值的范围以及与其他对象的关系。为了保持简单性，SNMP 仅用到 ASN.1 的一个子集，其中用到的 5 种通用类型。

## SNMPv1 中索引对象实例值转换成子标识符的转换规则

1. 如果索引对象实例取值为整数值，则把整数值作为一个子标识符
2. 如果索引对象实例取值为固定长度的字符串值，则把每个字节(OCTET)编码为一个子标识符
3. 如果索引对象实例取值为可变长的字符串值，则先把串的实际长度 n 编码为第一个子标识符，然后把每个字节编码为一个子标识符，总共 n+1 个子标识符
4. 如果索引对象实例取值为对象标识符，如果长度为 n，则先把 n 编码为第一个子标识符，后续该对象标识符的各个子标识符，总共 n+1 个子标识符
5. IP 地址，则变为 4 个子标识符
   表和行对象(例如 tcpConnTable 和 tcpConnEntry)是没有实例标识符的，因为它们不是叶子结点，SNMP 不能访问，其访问特性为“not-accessible”。这类对象叫做概念表和概念行。
   由于标量对象只能取一个值，因而从原则上说不必区分对象类型和对象实例。然而为了与列对象一致起见，SNMP 规定在标量对象标识符之后级联一个 0，表示该对象的实例标识符。

# 简单网络管理协议

## SNMPv1

SNMPv1 仅支持对管理对象值的检索和修改等简单操作。具体地说，SNMPv1 实体可以对 MIB-2 中的对象执行下列操作:

1. Get：管理站检索管理信息库中标量对象的值
2. Set：管理站设置管理信息库中标量对象的值
3. Trap：代理向管理站报告管理对象的状态变化。
   SNMPv1 不支持管理站改变管理信息库的结构，即不能增加和删除管理信息库中的管理对象实例，例如不能增加或删除表中的一行。一般来说，管理站也不能向管理对象发出执行一个动作的命令。管理站只能逐个访问管理信息库中的叶结点，不能一次性访问一个子树，例如不能访问整个表的内容。

### SNMPv1 报文

在 SNMP 管理中，管理站和代理之间交换的管理信息构成了 SNMP 报文。报文由 3 部分组成，即版本号、团体名和协议数据单元(PDU)。报文头中的版本号是指 SNMP 的版本，RFC 1157 为第 1 版。团体名用于身份认证。SNMP 共有 5 种 las 管理操作，但只有 3 种 PDU 格式。管理站发出的 3 种请求报文 GetRequest、GetNextRequest 和 SetRequest 采用的格式是一样的，代理的应答报文格式只有一种 GetResponsePDU，从而简少了 PDU 的种类。

### SNMPv1 的操作

> - P72\~P77， (4.3 SNMPv1 的操作，4.3.1\~4.3.4)

### SNMPv1 局限性

1. 由于轮询的性能限制，SNMPv1 不适合管理很大的网络
2. SNMPv1 不适合检索大量数据，例如检索整个表中的数据;
3. SNMPv1 的陷入报文是没有应答的，管理站是否收到陷入报文，代理不得而知，这样可能丢掉重要的管理信息;
4. SNMPv1 只提供简单的团体名认证，这样的安全措施是很不够的
5. SNMPv1 并不直接支持向被管理设备发送命令
6. SNMPv1 的管理信息库 MIB-2 支持的管理对象是很有限的，不足以完成复杂的管理功能
7. SNMPv1 不支持管理站之间的通信，而这一点在分布式网络管理中是很需要的。

## SNMPv2

与 SNMPv1 一样，SNMPv2 也是用 ASN.1 宏定义 OBJECT-TYPE 表示管理对象的语法和语义，但是 SNMPv2 的 OBJECT-TYPE 增加了新的内容，一项改变是，用 MAX-ACCESS 子句代替了 SNMPv1 的 ACCESS 子句

### SNMPv2 的两类表

1. 禁止删除和生成行的表, 这种表的最高的访问级别是 read-write。在很多情况下这种表由代理控制，表中只包含 read-only 型的对象
2. 允许删除和生成行的表, 这种表开始时可能没有行，由管理站生成和删除行。行数可由管理站或代理改变

### 允许生成和删除行的表的列对象

允许生成和删除行的表必须有一个列对象，其 SYNTAX 子句的值为 RowStatus, MAX-ACCESS 子句的值为 read-write，这种列叫做概念行的状态列。
状态列可取以下 6 种值：

1. active(可读写)：被管理设备可以使用概念行
2. notInService(可读写)：概念行存在，但由于其他原因(下面解释)而不能使用
3. notReady(只读)：概念行存在，但因没有信息而不能使用;
4. createAndGo(只写不读)：管理站生成一个概念行实例时先设置成这种状态，生成过程结束时自动变为 active，被管理设备就可以使用了
5. createAndWait(只写不读)：管理站生成一个概念行实例时先设置成这种状态，但不会自动变成 active
6. destroy(只写不读)：管理站需删除所有的概念行实例时设置成此状态
   选择好索引对象的实例标识符以后，管理站可以用两种方法产生概念行：
7. 一种是管理站通过事务处理一次性地产生和激活概念行
8. 另一种是管理站通过与代理协商，合作生成概念行
   挂起概念行：当概念行处于 active 状态时，如果管理站希望概念行脱离服务，以便进行修改，则可以发出 Set 命令，把状态列由 active 置为 notInService。
   删除概念行：管理站发出 Set 命令，把状态列置为 destroy，如果这个操作成功，则概念行立即被删除
   与 SNMPv1 一样，SNMPv2 的管理操作只能作用于标量对象，复杂的信息要用表来表示。按照 SNMPv2 规范，表是行的序列，而行是列对象的序列。

### SNMPv2 表的定义中的 INDEX 和 AUGMENTS 子句

在 SNMPv2 表的定义中必须含有 INDEX 或 AUGMENTS 子句，但是只能有一个。

#### INDEX 子句

INDEX 子句定义了一个基本概念行，而 INDEX 子句中的索引对象确定了一个概念行实例。与 SNMPv1 不同，SNMPv2 的 INDEX 子句中增加了任选的 IMPLIED 修饰符，从下面的解释中我们会了解到这个修饰符的作用。假定一个对象的标识符为 y，索引对象为 i1，i2，…，iN，则对象 y 的一个实例标识符为 y.(i1).(i2).….(iN)。
每个索引对象 i 的类型可能是（SNMPv2 中对象实例值转换成子标识符的转换规则）：

> SNMPv2 中对象实例值转换成子标识符的转换规则

- 整数：每个整数作为一个子标识符（仅对非负整数有效）
- 固定长度的字符串：每个字节编码为一个子标识符
- 有修饰符 IMPLIED 的变长度字符串：每个字节编码为一个子标识符，共 n 个子标识符
- 无修饰符 IMPLIED 的变长度字符串：第一个子标识符是 n，然后每个字节编码为一个子标识符，共 n+1 个子标识符
- 有修饰符 IMPLIED 的对象：对象标识符的 n 个子串
- 无修饰符 IMPLIED 的对象：第一个子标识符是 n，对象标识符的 n 个子串

#### AUGMENTS 子句

AUGMENTS 子句的作用是代替 INDEX 子句，表示概念行的扩展。课本中图 4.14 是这种表的一个例子，这个表是由 petTable 扩充的表。在扩充表中，AUGMENTS 子句中的变量(petEntry)叫做基本概念行，包含 AUGMENTS 子句的对象(moreEntry)叫做概念行扩展。这种设施的实质是在已定义的表对象的基础上通过增加列对象定义新表，而不必从头做起重写所有的定义。这样扩展定义的新表与全部定义的新表的作用完全一样，当然也可以经再一次扩展，产生更大的新表。
![4.14](/img/2.png)

### SNMPv2 的 3 种访问管理信息的方法

- 管理站和代理之间的请求/响应通信，这种方法与 SNMPv1 是一样的
- 管理站和管理站之间的请求/响应通信，这种方法是 SNMPv2 特有的，可以由一个管理站把有关管理信息告诉给另外一个管理站
- 代理系统到管理站的非确认通信，即由代理向管理站发送陷入报文，报告出现的异常情况，SNMPv1 中也有对应的通信方式
  SNMPv2 PDU 封装在报文中传送，报文头提供了简单的认证功能，而 PDU 可以完成上面提到的各种操作。我们首先介绍报文头的格式和作用，然后讨论协议数据单元的结构。

### SNMPv2 共有 7 种协议数据单元，分为 3 种 PDU 格式

**SNMPv2 共有 7 种协议数据单元，分为 3 种 PDU 格式**。注意 GetRequest、GetNextRequest、SetRequest、InformRequest 和 Trap 等 5 种 PDU 与 Response PDU 具有相同的格式，只是它们的错误状态和错误索引字段被置为 0，这样就减少了 PDU 格式的种类。

### SNMPv2 对 GetRequest 操作的响应方式

SNMPv2 对 GetRequest 操作的响应方式与 SNMPv1 不同，SNMPv1 的响应是原子性的，即只要有一个变量的值检索不到，就不返回任何值。而 SNMPv2 的响应不是原子性的，允许部分响应。

### SNMPv2 对 GetNextRequest 操作的响应方式

在 SNMPv2 中，GetNextRequest 检索请求的格式和语义与 SNMPv1 基本相同，惟一的差别就是改变了响应的原子性。

### SNMPv2 对 GetBulkRequest 操作的响应方式

GetBulkRequest 是 SNMPv2 对原标准的主要增强，目的是以最少的交换次数检索大量的管理信息，或者说管理站要求尽可能大的响应报文。对这个操作的响应，在选择 MIB 变量值时采用与 GetNextRequest 同样的原理，即按照词典顺序选择后继对象实例，但是这个操作可以说明多种不同的后继。

### InformRequest

InformRequest 这是管理站发送给管理站的消息。但是与陷入不同，这个消息是需要应答的。
SNMPv2 增加的管理站之间的通信机制是分布式网络管理所需要的功能特征，为此引入了通知报文 InformRequest 和管理站数据库(manager-to-manager MIB)

## SNMPv3

SNMPv3 中的 RFC 2571 文件描述了 SNMPv3 的管理框架。在 SNMPv3 的管理框架中，以前叫做管理站和代理的东西现在统一叫做 SNMP 实体(SNMP Entity)。实体是体系结构的一种实现，由一个 SNMP 引擎(SNMP Engine)和一个或多个有关的 SNMP 应用(SNMP Application)组成。

### SNMP 引擎结构

SNMP 引擎具有复杂的结构，它包含一个调度器(Dispatcher),一个报文处理子系统(Message Processing Subsystem)，一个安全子系统(Security Subsystem)，一个访问控制子系统(Access Control Subsystem)。NMP 引擎有惟一的标识 snmpEngineID，这个标识在一个上层管理域中是无二义性的。由于 SNMP 引擎和 SNMP 实体具有一一对应的关系，因而 snmpEngineID 也是对应的 SNMP 实体的惟一标识。

### SNMP 引擎服务

SNMP 引擎提供下列服务

1. 发送和接收报文
2. 认证和加密报文
3. 控制对管理对象的访问。
   一个 SNMP 引擎只有一个调度器，它可以并发地处理多个版本的 SNMP 报文。

### SNMPv3 的报文处理子系统

SNMPv3 的报文处理子系统由一个或多个报文处理模块(Message Processing Model)组成。每一个报文处理模块定义了一种特殊的 SNMP 报文格式，它的功能是按照预定的格式准备要发送的报文，或者从接收的报文中提取数据。

### SNMPv3 的安全子系统

SNMPv3 的安全子系统提供安全服务，例如报文的认证和加密。一个安全子系统可以有多个安全模块，以便提供各种不同的安全服务。安全子系统由安全模型和安全协议组成。每一个安全模块定义了一种具体的安全模型，说明它可以防护的安全威胁、它提供安全服务的目标和使用的安全协议。而安全协议则说明了用于提供安全服务(例如认证和加密)的机制、过程以及 MIB 对象。目前 SNMPv3 标准提供了基于用户的安全模型(User-Based Security Model，USM)。

#### SNMPv3 安全协议的 3 个模块

##### 时间序列模块：提供对报文延迟和重放的防护

关于时间序列模块，为了防止报文被重放和故意延迟，在每一次通信中有一个 SNMP 引擎被指定为是有权威的(Authoritative，记为 AU)，而通信对方则是无权威的(Non-Authoritative，记为 NA)。当 SNMP 报文要求响应时，该报文的接收者是有权威的。当 SNMP 报文不要求响应时，该报文的发送者是有权威的。有权威的 SNMP 引擎维持一个时钟值，无权威的 SNMP 引擎跟踪这个时钟值，并保持与之松散同步。

##### 认证模块：提供完整性和数据源认证

报文认证码(Message Authentication Code, MAC)
 通常在共享密钥的两个实体之间使用，这里的 MAC 机制使用散列(Hash)函数作为密码，因此叫做 HMAC。HMAC 可以结合任何重复加密的散列函数，例如 MD5 和 SHA-1。HMAC-MD5-96 认证协议就是使用散列函数 MD5 的报文认证协议，输出的报文摘要长度为 96 位。HMAC-MD5-96 是 USM 必须支持的第一个报文摘要认证协议。这个协议可以验证报文的完整性，还可以验证数据源的有效性。HMAC-SHA-96 是 SNMPv3 的 USM 必须支持的第二个认证协议，与前一个协议不同的是它使用 SHA 散列函数作为密码，计算 160 位的报文摘要，然后截取前 96 位作为 MAC。

##### 加密模块：防止报文内容的泄露

基于 SNMPv3 的 USM 定义的第一个加密协议是 CBC-DES。它按照 CBC(Cipher Block Chaining)模式对 64 位长的明文块进行 DES 加密，最后产生的密文也被分成 64 位的块。在进行加密之前先要对用户的私有密钥(16 字节长)进行一些变换，产生数据加密用的 DES 密钥和初始化矢量(Initialization Vector, IV)。

### 访问控制子系统通过访问控制模块

访问控制子系统通过访问控制模块(Access Control Model)提供授权服务，即确定是否允许访问一个管理对象，或者是否可以对某个管理对象实施特殊的管理操作。每个访问控制模块定义了一个具体的访问决策功能，用以支持对访问权限的决策。在应用程序的处理过程中，访问控制模块还可以通过已定义的 MIB 模块进行远程配置访问控制策略。SNMPv3 定义了基于视图的访问控制模型(View-Based Access Control Model)。

### SNMPv3 的应用程序

SNMPv3 的应用程序分为 5 种

- 命令生成器(Command Generator)：建立 SNMP Read/Write 请求，生成相应的命令报文
- 命令响应器(Command Responder)：接收 SNMP Read/Write 请求，对管理数据进行访问，并按照协议规定的操作产生响应报文，返回给读/写命令的发送者
- 通知发送器(Notification Originator)：监控系统中出现的特殊事件，产生通知类报文，并且要有一种机制，以决定向何处发送报文，使用什么 SNMP 版本和安全参数等
- 通知接收器(Notification Receiver)：监听通知报文，并对确认型通知产生响应
- 代理转发器(Proxy Forwarder)：在 SNMP 实体之间转发报文

# 远程网络监视

远程网络监视是对 SNMP 标准的重要补充，是简单网络管理向互联网管理过度的重要步骤。RMON 扩充了 SNMP 的管理信息库，可以提供有关互联网管理的主要信息，在不改变 SNMP 协议的条件下增强了网络管理的功能。
MIB-2 能提供的只是关于单个设备的管理信息，例如进出某个设备的分组数或字节数，而不能提供整个网络的通信情况。通常用于监视整个网络通信情况的设备叫做网络监视器(Monitor)或网络分析器(Analyzer)、探测器(Probe)等。监视器观察 LAN 上出现的每个分组，并进行统计和总结，给管理人员提供重要的管理信息。监视器还能存储部分分组，供以后分析用。监视器也根据分组类型进行过滤并捕获特殊的分组。通常每个子网配置一个监视器并与中央管理站通信，因此也称其为远程监视器。
过滤组提供一种手段，使得监视器可以观察接口上的分组，通过过滤选择出某种指定的特殊分组。这个组定义了两种过滤器：数据过滤器按位模式匹配，即要求分组的一部分匹配或不匹配指定的位模式；而状态过滤器按状态匹配，即要求分组具有特定的错误状态(有效、CRC 错误等)。各种过滤器可以用逻辑运算(AND、OR 等)来组合，形成复杂的测试模式。一组过滤器的组合叫做通道(channel)。

## 位过滤逻辑

位过滤逻辑中，我们定义与位过滤逻辑测试有关的变量：input ：被过滤的输入分组；filterPktData ：用于测试的位模式；filterPktDataMask ：要测试的有关匹配位的掩码；filterPktDataNotMask ：要测试的有关非匹配位的掩码。
状态过滤逻辑中，为每一种错误条件指定一个整数值，并且是 2 的幂。为了得到状态模式，只要把各个错误条件的值相加，这样就把状态模式转换成了位模式。状态过滤逻辑实际上是转换为位模式进行处理。
通道由一组过滤器定义，被测试的分组要通过通道中有关过滤器的检查。分组是否被通道接受，取决于通道配置中的一个变量　　 channelAcceptType\::=INTEGER｛acceptMatched(1),acceptFailed(2)｝。如果该变量的值为 1，则分组数据和分组状态至少要与一个过滤器匹配，则分组被接受；如果该变量的值为 2，则分组数据和分组状态与每一个过滤器都不匹配，则分组被接受。

## RMON

RMON MIB 只能存储 MAC 层管理信息。从 1994 年开始，对 RMON MIB 进行了扩充，使得能够监视 MAC 层之上的通信。这就是所谓的 RMON2，而把最初的 RMON 成为 RMON1。RMON2 监视 OSI/RM 第 3 到第 7 层的通信，能对数据链路层以上的分组进行译码。

## RMON2

> P137\~P138，(5.3.2 RMON2 增加的功能，2.时间过滤器索引)
> RMON2 中类型为 TimeFilter 的对象专门用于表索引。这个索引的用途是使得管理站可以从监视器取得自从某个时间以来改变过的变量，这里的时间由类型为 TimeFilter 的对象表示。
> RMON2 用协议标识符和协议参数共同表示一个协议以及该协议与其他协议之间的关系。协议标识符是由字节串组成的分层的树结构，类似于 MIB 对象组成的树。RMON2 赋予每一个协议层 32 位的字节串，编码为 4 个十进制数，表示为\{a.b.c.d\} 的形式，这是协议标识符树的结点。RMON2 的协议标识符的格式，开头有一个字节的长度计数字段 cnt，后续各层协议的子标识符字段。每层协议的子标识符都与上述链路层协议字节串相似，是 32 位，编码为 4 个十进制数。协议参数的格式为长度计数字段后跟各层协议的参数，每层协议参数占 1 个字节。参数的每一个比特定义了一种能力。

# SNMPc 网络管理软件的使用

SNMPc 是一个分布式网络管理平台，该软件具有良好的伸缩性、可扩展性和可靠性，以及较高的管理效率。通过 Windows 客户端控制台和 JAVA Web 控制台可以远程监控网络，扩大管理信息的共享范围，适合多用户管理。通过运行在多个计算机上的服务元素可以扩展功能，适用于任意规模的系统，最多可管理 25000 个网络设备。该软件还能有效地支持 SNMPv3 的安全特性，具有事件审计功能，可以设置冗余备份服务器，是一个可靠的网络管理系统。

# 网络分析系统

科来网络分析系统是一种优秀的网络分析产品，它可以安装在手提电脑上，在任何有问题的地方采集网络数据包并进行实时的故障诊断，也可以通过回放由数据包组成的存档文件，实现对网络历史为的回溯分析。

# 网络管理工具

网络监听的原理：由于以太网采用广播通信方式，所以在网络中传送的分组可以出现在同一冲突域中的所有端口上。在常规状态下，网卡控制程序只接收发送给自己的数据包和广播包，把目标地址不是自己的数据包丢弃。如果把网卡配置成混杂模式(Promiscuous Mode)，它就能接收所有分组，无论是否是发送给自己的。
嗅探器(Sniffer)就是采用混杂模式工作的协议分析器，可以用纯软件实现，运行在普通的计算机上；也可以做成硬件，用独立设备实现高效率的网络监控。

# 网络测试与性能评价

网络测试是利用测试工具检验网络设备或网络系统运行状态、获取性能参数的过程。被测试的对象可以分为网络设备和网络系统两大类。
网络设备测试是对联网设备(例如路由器、交换机、防火墙等)的功能和技术指标进行测试。网络设备测试基本上是按照网络设备实现的协议进行的，即根据协议规范对设备施加激励，观察被测设备的外部行为。测试主要分为以下五种：

- 功能测试(Functional Testing)
- 一致性测试(Conformance Testing)
- 性能测试(Performance Testing)
- 互操作测试(Interoperability Testing)
- 健壮性测试(Robustness Testing)

## 网络系统测试

网络系统测试是对网络系统总体性能的测试，这种测试并不注重对单个网络设备的功能进行验证，而主要是对跨网络的端到端节点间的性能指标进行测试。
网络互联设备的基准测试

- 吞吐率(Throughput)
- 时延(Latency)
- 丢包率(Frame loss rate)
- 背靠背(Back-to-back frame)
- 系统恢复(System recovery)
- 重启时间(Reset)等

局域网交换设备测试中，测试流量分为单向流量和双向流量，测试流量分布模式分为非网状流量、部分网状流量和全网状流量等三类。
测试结构是指测试设备与被测设备之间的连接模式。测试结构通常分为单机结构和双机结构。

## 网络测试工具

网络测试工具可以是专门开发的网络测试软件，也可以是建立在硬件平台上的网络测试仪表。网络测试软件的成本较低，容易安装测试，可以满足一般功能测试和一致性测试的需要，但是受用户主机的性能影响，不太适合高强度的压力测试，这种测试的结果也可能误差很大。网络测试工具具有专门硬件平台的网络测试仪表采用 ASIC 或 FPGA 高速电路制造，能满足高强度压力测试的需要。

## 网络测试过程

网络测试(Network Test)是一个复杂的过程，至少包括以下 3 个组成部分

- 测试框架配置
- 测试执行过程
- 测试结果分析和报告

## 网络测量方法

根据网络测量过程的复杂程度，网络测量方法可分为 4 类

- 直接测量法
- 预测法
- 分解法
- 推理法
  要实现对网络性能指标精确有效的测量，测量方法必须具有可重复性、连续性、稳定性、失真度小。

## 二/三层设备转发性能测试中，交换机按照处理帧的不同方式

二/三层设备转发性能测试中，交换机按照处理帧的不同方式分为存储-转发式(store-forward)和直通式(cut-through)，这两种交换方式的转发时延有所区别。工作在存储转发模式的交换机在转发之前必须接收完整个报文，并且进行差错校验，如果没有错误再发往目标地址，所以报文需要全部进入缓存后再转发。工作于直通方式的交换机只要检查到报文头中所包含的目标地址就立即进行转发，无需等待报文全部被接收，也不进行差错校验。

## 三种转发时延类型

三种转发时延类型

- LILO(Last-In/Last-Out)
 LIFO 时间是交换机完全接收到报文后，进行表项查找、缓冲区调度、再开始转发所需要的时间。存储-转发交换机使用这个时间来衡量时延, 这种时延计算方式不受转发报文大小的影响。
- LIFO(Last-In/First-Out)
- FIFO(First-In/First-Out)直通交换机采用 FIFO 时延计算方式。这种时延不受转发报文大小的影响。
